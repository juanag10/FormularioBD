<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n de Clientes</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">
<h2>Formulario de Clientes</h2>

<input type="hidden" id="id_cliente">

<input id="nombre" placeholder="Nombre">
<input id="email" placeholder="Email">
<input id="telefono" placeholder="Tel√©fono">

<div class="botones">
    <button class="insertar" onclick="insertar()">Insertar</button>
    <button class="consultar" onclick="consultar()">Consultar</button>
    <button class="modificar" onclick="modificar()">Modificar</button>
    <button class="eliminar" onclick="eliminar()">Eliminar</button>
</div>

<div class="estado" id="estado"></div>

<table>
<thead>
<tr>
    <th>Nombre</th>
    <th>Email</th>
    <th>Tel√©fono</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>
</div>

<script>
let seleccionado = null;

function mensaje(texto, color="green") {
    estado.innerText = texto;
    estado.style.color = color;
}

function insertar() {
    fetch("/clientes", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            nombre: nombre.value,
            email: email.value,
            telefono: telefono.value
        })
    }).then(() => {
        mensaje("Cliente insertado ‚úÖ");
        limpiar();
        consultar();
    });
}

function consultar() {
    fetch("/clientes")
    .then(res => res.json())
    .then(data => {
        tabla.innerHTML = "";
        data.forEach(c => {
            tabla.innerHTML += `
            <tr onclick='seleccionar("${c.id_cliente}","${c.nombre}","${c.email}","${c.telefono}")'>
                <td>${c.nombre}</td>
                <td>${c.email}</td>
                <td>${c.telefono}</td>
            </tr>`;
        });
        mensaje("Datos cargados üìã", "blue");
    });
}

function seleccionar(idCliente,n,e,t) {
    seleccionado = idCliente;
    nombre.value = n;
    email.value = e;
    telefono.value = t;
    mensaje("Registro seleccionado ‚úèÔ∏è", "orange");
}

function modificar() {
    if (!seleccionado) {
        mensaje("Seleccione un registro", "red");
        return;
    }

    fetch("/clientes/" + seleccionado, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            nombre: nombre.value,
            email: email.value,
            telefono: telefono.value
        })
    }).then(() => {
        mensaje("Cliente modificado ‚úÖ");
        limpiar();
        consultar();
    });
}

function eliminar() {
    if (!seleccionado) {
        mensaje("Seleccione un registro", "red");
        return;
    }

    fetch("/clientes/" + seleccionado, { method: "DELETE" })
    .then(() => {
        mensaje("Cliente eliminado üóëÔ∏è", "red");
        limpiar();
        consultar();
    });
}

function limpiar() {
    nombre.value = "";
    email.value = "";
    telefono.value = "";
    seleccionado = null;
}
</script>

</body>
</html>
